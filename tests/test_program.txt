;===============================================
; Test Name: Comprehensive ISA Feature Test
; Description: Tests all major ISA features including:
;   - Register operations (MOV)
;   - Memory operations (LOAD)
;   - Arithmetic (ADD, SUB, INC, DEC)
;   - Logical (NOT, AND, OR)
;   - Control flow (JMP, JZ, JNZ)
;   - Cache behavior
;
; Expected Results:
;   - Final register values:
;     * eax = 0 (counted down from 10)
;     * ebx = 6 (incremented then decremented)
;     * ecx = 12 (loop counter)
;     * edx = 12 (after AND operations)
;     * esi = 123 (from memory)
;     * edi = 15 (after AND operations)
;   - Cache performance:
;     * Should show hits for repeated memory access
;     * Should demonstrate L1/L2 interaction
;===============================================

; Initialize registers
MOV eax #5
MOV ebx #42
MOV ecx #0
MOV edx #10
MOV esi #42
MOV edi #15

; Store some values in memory
MOV [100] #42  ; Memory[100] = 42
MOV [104] #123 ; Memory[104] = 123
MOV [108] #255 ; Memory[108] = 255

; Load values from memory to demonstrate cache
LOAD edx [100] ; edx = 42
LOAD esi [104] ; esi = 123
LOAD edi [108] ; edi = 255

; Memory ops
MOV [100] ebx
LOAD ebx [100]

; Arithmetic
ADD edx #5
SUB edx #10
INC edx
DEC edx

; Bitwise
OR esi #21
AND edi esi
XOR esi #21
NOT edi

; Shifts
MOV ebx #64
SHL ebx #1
SHR ebx #2

; Control flow
loop:
    ADD ecx #1
    SUB eax #1
    JNZ loop

; Final state check
JZ done        ; If eax == 0, we're done
JMP error      ; Otherwise, something went wrong

done:
HALT

error:
MOV eax #0     ; Set error code
HALT
